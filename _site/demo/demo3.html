<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.30">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Emi Tanaka">
<meta name="dcterms.date" content="2024-10-15">
<meta name="description" content="Demo 3">

<title>LLM Workshop – Applications to real data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>

      .quarto-title-block .quarto-title-banner {
        background: #f8f9fa;
      }
</style>


<link rel="stylesheet" href="../assets/custom.css">
<link rel="stylesheet" href="../assets/exercises.css">
<link rel="stylesheet" href="../assets/code.css">
<link rel="stylesheet" href="../styles.css">
<link rel="stylesheet" href="../assets/highlight.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">LLM Workshop</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> <i class="bi bi-house-fill" role="img">
</i> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-slides" role="button" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-book" role="img">
</i> 
 <span class="menu-text">Slides</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-slides">    
        <li>
    <a class="dropdown-item" href="../slides/slide1.html">
 <span class="dropdown-text">Introductions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../slides/slide2.html">
 <span class="dropdown-text">Landscape of Large Language Models</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../slides/slide3.html">
 <span class="dropdown-text">Architecture of Large Language Models</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../slides/slide4.html">
 <span class="dropdown-text">Discussion &amp; Conclusion</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-fa-brands-r-project--demo" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text"><i class="fa-brands fa-r-project" aria-label="r-project"></i> Demo</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-fa-brands-r-project--demo">    
        <li>
    <a class="dropdown-item" href="../demo/demo1.html">
 <span class="dropdown-text">Interfacing with large language models</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../demo/demo2.html">
 <span class="dropdown-text">Playing with model parameters</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../demo/demo3.html">
 <span class="dropdown-text">Applications to real data</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../index.html#sec-license"> 
<span class="menu-text"><i class="fas fa-id-badge"></i> License</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Applications to real data</h1>
            <p class="subtitle lead"><i class="fa-brands fa-r-project" aria-label="r-project"></i> Demo</p>
                  <div>
        <div class="description">
          <span class="tag-workshop">Demo 3</span>
        </div>
      </div>
                </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Emi Tanaka </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">October 15, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#airbnb-reviews-data" id="toc-airbnb-reviews-data" class="nav-link active" data-scroll-target="#airbnb-reviews-data"><span class="header-section-number">1</span> AirBnB reviews data</a>
  <ul class="collapse">
  <li><a href="#sentiment-score" id="toc-sentiment-score" class="nav-link" data-scroll-target="#sentiment-score"><span class="header-section-number">1.1</span> Sentiment score</a></li>
  <li><a href="#summarise-texts" id="toc-summarise-texts" class="nav-link" data-scroll-target="#summarise-texts"><span class="header-section-number">1.2</span> Summarise texts</a></li>
  </ul></li>
  <li><a href="#salary" id="toc-salary" class="nav-link" data-scroll-target="#salary"><span class="header-section-number">2</span> Salary</a>
  <ul class="collapse">
  <li><a href="#sec-cluster" id="toc-sec-cluster" class="nav-link" data-scroll-target="#sec-cluster"><span class="header-section-number">2.1</span> Clustering</a></li>
  <li><a href="#sec-classify" id="toc-sec-classify" class="nav-link" data-scroll-target="#sec-classify"><span class="header-section-number">2.2</span> Classification</a></li>
  <li><a href="#standardise-data" id="toc-standardise-data" class="nav-link" data-scroll-target="#standardise-data"><span class="header-section-number">2.3</span> Standardise data</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p><img src="../images/demo3-cover.jpg" class="preview-image img-fluid" alt="The image shows a laptop screen displaying a graphical representation of the Earth with various data points and lines overlaid on it."></p>
<p><span style="color:#C0C0C0!important"><i class="fas fa-desktop"></i> This demo assumes that you have all the <a href="../index.html#software" style="color:#C0C0C0!important">software requirements</a>.</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SAI)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(elmer)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We’ll use LLMs to help us with the following data processing tasks:</p>
<ul>
<li>give a sentiment score from text,</li>
<li>summarise the text,</li>
<li>cluster the text entries,</li>
<li>classify the text into particular categories, and</li>
<li>standardise the data.</li>
</ul>
<p><i class="fa-solid fa-exclamation-circle" aria-label="exclamation-circle"></i> Make sure to validate by doing spot checks or otherwise!</p>
<p><i class="fa-solid fa-exclamation-circle" aria-label="exclamation-circle"></i> LLM may propagate majority view so take caution on its usage, particularly for classification tasks.</p>
<section id="airbnb-reviews-data" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="airbnb-reviews-data"><span class="header-section-number">1</span> AirBnB reviews data</h2>
<p>The <code>airbnb_reviews</code> data from the <code>SAI</code> package contains AirBnB reviews in Sydney, Australia. We look at the listing “Heart of Rockdale 2” (ID 35428495) with host Jason. The host describes the neighbourhood of the listing as below.</p>
<blockquote class="blockquote">
<p>good location easy to access all Sydney has to offer..</p>
</blockquote>
<p>This listing has 20 reviews shown below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>reviews <span class="ot">&lt;-</span> airbnb_reviews <span class="sc">|&gt;</span> </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(listing_id <span class="sc">==</span> <span class="dv">35428495</span>) <span class="sc">|&gt;</span> </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(review_text)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>reviews</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Excellent place to stay for single person travelling. All necessities are there hair dryer, kitchenette, cutlery, clean towels and so on. Highly recommended."                                                                                                                                                                                                                                                                             
 [2] "Good privacy and self contained."                                                                                                                                                                                                                                                                                                                                                                                                          
 [3] "Convenient location, east check in and clean space. Would stay again."                                                                                                                                                                                                                                                                                                                                                                     
 [4] "다음날 공항에 가기 전 묵기 좋았습니다&lt;br/&gt;깔끔해서 묵기 편했습니다&lt;br/&gt;하지만 난방기구가 하나도 없어서 저는 밤새 덜덜 떨면서 자야 했습니다...🥲&lt;br/&gt;너무 추운거 빼고는 완벽했습니다"                                                                                                                                                                                                                                                       
 [5] "Great location, walking distance to train station, cafes, restaurants and Lady Robinson's beach. If you need to work or stream, bring your own internet."                                                                                                                                                                                                                                                                                  
 [6] "Good stay overall!"                                                                                                                                                                                                                                                                                                                                                                                                                        
 [7] "Great little single person room, good for short .&lt;br/&gt;It has a kitchenette, clean and usable toilet and shower.&lt;br/&gt;Lots of good food in Rockdale within walking distance"                                                                                                                                                                                                                                                                 
 [8] "Thanks Jason, was perfect for what I needed"                                                                                                                                                                                                                                                                                                                                                                                               
 [9] "Clean &amp; tidy place, Convient location with proximity to shops,airport &amp; train."                                                                                                                                                                                                                                                                                                                                                            
[10] "Very last minute booking due to delayed flight, very close to airport. Thanks for the accomodation Jason! Highly recommend :)"                                                                                                                                                                                                                                                                                                             
[11] "it's a tidy clean home. and Jason is nice . it's just the time i arrived was late and the light is not on. as a girl i'll be a bit scared ,and really suggest jason to change the blind into some thicker material, that blind for girls are not very safe. and could put a inside locker chain. i know it's a female thing. but it will definitely make us feel safer. ty"                                                                
[12] "An older style room with older furniture, but very clean and functional. Great communication from the owner."                                                                                                                                                                                                                                                                                                                              
[13] "Had a great stay. Fantastic location close to the airport and Jason was very accommodating and easy to communicate with."                                                                                                                                                                                                                                                                                                                  
[14] "Everything was perfect, great host"                                                                                                                                                                                                                                                                                                                                                                                                        
[15] "Good basic accommodation for one person needing to make an early start for the airport."                                                                                                                                                                                                                                                                                                                                                   
[16] "Excellent for a quick stay"                                                                                                                                                                                                                                                                                                                                                                                                                
[17] "Stayed here for 2.5 weeks and was really happy with the place. The unit was tiny, but had all the amenities I needed as a solo traveller. 10 min walk to the ocean and beaches, Rockdale train station, Anytime Fitness,  shopping centre and Coles supermarket. I work remotely, so the only thing I wish was better was the wifi, which was pretty spotty most days. I used my wifi hotspot or worked from a café, so that worked for me"
[18] "Super handy to Sydney Airport, very prompt and clear communication, and totally reasonable, simple accommodation with everything that any reasonable maintenance person would happily need."                                                                                                                                                                                                                                               
[19] "thank you, clean convenient and quiet neighbourhood"                                                                                                                                                                                                                                                                                                                                                                                       
[20] "Perfect for one night for solo travellors. All u need in a small bedsit. Can be cold though so either ask for another blanket or take a spare one."                                                                                                                                                                                                                                                                                        </code></pre>
</div>
</div>
<section id="sentiment-score" class="level3" data-number="1.1">
<h3 data-number="1.1" class="anchored" data-anchor-id="sentiment-score"><span class="header-section-number">1.1</span> Sentiment score</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-overflow-wrap code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>sentimenter <span class="ot">&lt;-</span> <span class="fu">chat_ollama</span>(<span class="at">model =</span> <span class="st">"llama3.1:8b"</span>, </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>                           <span class="at">system_prompt =</span> <span class="st">"Score the sentiment of the input text from 1 to 10 where 1 is the most negative and 10 is the most positive. Just return the sentiment score only."</span>,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">seed =</span> <span class="dv">1</span>,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">api_args =</span><span class="fu">list</span>(<span class="at">top_p =</span> <span class="fl">0.1</span>, </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">temperature =</span> <span class="dv">0</span>))</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># for each review, ask the `sentimenter` to score.</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>sentiment <span class="ot">&lt;-</span> <span class="fu">map_dbl</span>(reviews, <span class="sc">~</span><span class="fu">as.numeric</span>(sentimenter<span class="sc">$</span><span class="fu">chat</span>(.x)))</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(sentiment)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8.75</code></pre>
</div>
</div>
<p>So the mean sentiment of this listing is 8.75 out of 10. You can see the review text and sentiment score computed by the LLM in <a href="#tbl-sentiment" class="quarto-xref">Table&nbsp;1</a>. Do you agree with the scoring? It’s a good idea to do some sample checks that it’s working as intended before processing your data in large scale.</p>
<div class="cell omitshadow">
<div id="tbl-sentiment" class="cell omitshadow quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-sentiment-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: The review text and corresponding sentiment score computed by the LLM.
</figcaption>
<div aria-describedby="tbl-sentiment-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell omitshadow table table-sm table-striped small">
<colgroup>
<col style="width: 97%">
<col style="width: 2%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">reviews</th>
<th style="text-align: right;">sentiment</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Excellent place to stay for single person travelling. All necessities are there hair dryer, kitchenette, cutlery, clean towels and so on. Highly recommended.</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="even">
<td style="text-align: left;">Good privacy and self contained.</td>
<td style="text-align: right;">8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Convenient location, east check in and clean space. Would stay again.</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="even">
<td style="text-align: left;">다음날 공항에 가기 전 묵기 좋았습니다<br>깔끔해서 묵기 편했습니다<br>하지만 난방기구가 하나도 없어서 저는 밤새 덜덜 떨면서 자야 했습니다…🥲<br>너무 추운거 빼고는 완벽했습니다</td>
<td style="text-align: right;">6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Great location, walking distance to train station, cafes, restaurants and Lady Robinson’s beach. If you need to work or stream, bring your own internet.</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="even">
<td style="text-align: left;">Good stay overall!</td>
<td style="text-align: right;">8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Great little single person room, good for short .<br>It has a kitchenette, clean and usable toilet and shower.<br>Lots of good food in Rockdale within walking distance</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="even">
<td style="text-align: left;">Thanks Jason, was perfect for what I needed</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Clean &amp; tidy place, Convient location with proximity to shops,airport &amp; train.</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="even">
<td style="text-align: left;">Very last minute booking due to delayed flight, very close to airport. Thanks for the accomodation Jason! Highly recommend :)</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="odd">
<td style="text-align: left;">it’s a tidy clean home. and Jason is nice . it’s just the time i arrived was late and the light is not on. as a girl i’ll be a bit scared ,and really suggest jason to change the blind into some thicker material, that blind for girls are not very safe. and could put a inside locker chain. i know it’s a female thing. but it will definitely make us feel safer. ty</td>
<td style="text-align: right;">7</td>
</tr>
<tr class="even">
<td style="text-align: left;">An older style room with older furniture, but very clean and functional. Great communication from the owner.</td>
<td style="text-align: right;">8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Had a great stay. Fantastic location close to the airport and Jason was very accommodating and easy to communicate with.</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="even">
<td style="text-align: left;">Everything was perfect, great host</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Good basic accommodation for one person needing to make an early start for the airport.</td>
<td style="text-align: right;">8</td>
</tr>
<tr class="even">
<td style="text-align: left;">Excellent for a quick stay</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Stayed here for 2.5 weeks and was really happy with the place. The unit was tiny, but had all the amenities I needed as a solo traveller. 10 min walk to the ocean and beaches, Rockdale train station, Anytime Fitness, shopping centre and Coles supermarket. I work remotely, so the only thing I wish was better was the wifi, which was pretty spotty most days. I used my wifi hotspot or worked from a café, so that worked for me</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="even">
<td style="text-align: left;">Super handy to Sydney Airport, very prompt and clear communication, and totally reasonable, simple accommodation with everything that any reasonable maintenance person would happily need.</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="odd">
<td style="text-align: left;">thank you, clean convenient and quiet neighbourhood</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="even">
<td style="text-align: left;">Perfect for one night for solo travellors. All u need in a small bedsit. Can be cold though so either ask for another blanket or take a spare one.</td>
<td style="text-align: right;">8</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
</section>
<section id="summarise-texts" class="level3" data-number="1.2">
<h3 data-number="1.2" class="anchored" data-anchor-id="summarise-texts"><span class="header-section-number">1.2</span> Summarise texts</h3>
<p>For summarising the text, we need to parse all reviews. To do this we have to collapse all the review text into one but also have a way to signal that the reviews are separate. To do this we’ll quote each review and separate them by a comma.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-overflow-wrap code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>review_all <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">paste0</span>(<span class="st">'"'</span>, reviews,<span class="st">'"'</span>), <span class="at">collapse =</span> <span class="st">", "</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>summariser <span class="ot">&lt;-</span> <span class="fu">chat_ollama</span>(<span class="at">model =</span> <span class="st">"llama3.1:8b"</span>,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">system_prompt =</span> <span class="st">"The user will input reviews of a listing. Summarise the input text into one paragraph including the overall sentiment. Just return the summary."</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">seed =</span> <span class="dv">1</span>,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">api_args =</span> <span class="fu">list</span>(<span class="at">top_p =</span> <span class="fl">0.1</span>,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">temperature =</span> <span class="dv">0</span>))</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>summariser<span class="sc">$</span><span class="fu">chat</span>(review_all) <span class="sc">|&gt;</span> <span class="fu">cat</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The listing is a simple, self-contained accommodation suitable for single travelers, with all the necessary amenities such as kitchenette, clean towels, and hair dryer. The location is convenient, close to public transport, shops, and beaches, making it ideal for short stays or early departures from Sydney Airport. While some guests noted that the room can be cold, especially at night, most reviewers praised the cleanliness, tidiness, and good communication with the owner. Overall, the sentiment is overwhelmingly positive, with many guests recommending the listing to others.</code></pre>
</div>
</div>
<p>What do you think about the summary it produced? Again, do some spot checks!</p>
<p><strong>Bonus</strong>: you may have noticed that the fourth review is in another language. You can use LLM to identify and translate text. For convenience, <code>SAI</code> package does this for you as follows.</p>
<p>We’ll set the model for <code>SAI</code> first.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sai_set_model</span>(<span class="fu">model_ollama</span>(<span class="at">model =</span> <span class="st">"llama3.1:8b"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can identify the language as:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sai_what_language</span>(reviews[<span class="dv">4</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Korean"</code></pre>
</div>
</div>
<p>And translate to English (default) as below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sai_translate</span>(reviews[<span class="dv">4</span>]) <span class="sc">|&gt;</span> <span class="fu">cat</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>I stayed here the night before flying out and it was great. The place is very clean and comfortable. However, there were no heating devices so I shivered all night. It was perfect except for the cold.</code></pre>
</div>
</div>
<p>The above functions are convenient functions that use LLM under the hood.</p>
</section>
</section>
<section id="salary" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="salary"><span class="header-section-number">2</span> Salary</h2>
<p>The <code>salary</code> data from <code>SAI</code> contains the survey results from a <a href="https://www.askamanager.org/2021/04/how-much-money-do-you-make-4.html">2021 Ask a Manager Salary Survey</a>.</p>
<p>We’ll take a 400 random responses to reduce the time for demonstration.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>salary_sample <span class="ot">&lt;-</span> <span class="fu">slice_sample</span>(salary, <span class="at">n =</span> <span class="dv">400</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="sec-cluster" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="sec-cluster"><span class="header-section-number">2.1</span> Clustering</h3>
<p>The responders entered the job title by text, as such there are as many job titles as many responders. We may wish to group them thematically so we’ll cluster them using the LLM as below.</p>
<p>In this process, you may like to cluster the group based on a sub-sample (200 below) as LLM have a context window and the long list of all job titles may make the input text unwieldy long.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>job_all <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">paste0</span>(<span class="st">'"'</span>, <span class="fu">sample</span>(salary_sample<span class="sc">$</span>job_title, <span class="dv">200</span>), <span class="st">'"'</span>), <span class="at">collapse =</span> <span class="st">", "</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>job_grouper <span class="ot">&lt;-</span> <span class="fu">chat_ollama</span>(<span class="at">model =</span> <span class="st">"llama3.1:8b"</span>,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">system_prompt =</span> <span class="st">"The input text is a list of job title from survey responses. Clean the job titles and group similar job titles together. Just return the groups only as a json object."</span>,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">seed =</span> <span class="dv">1</span>,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">api_args =</span> <span class="fu">list</span>(<span class="at">top_p =</span> <span class="fl">0.5</span>,</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">temperature =</span> <span class="dv">0</span>,</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">response_format =</span> <span class="fu">list</span>(<span class="at">type =</span> <span class="st">"json_object"</span>)))</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>job_groups <span class="ot">&lt;-</span> job_grouper<span class="sc">$</span><span class="fu">chat</span>(job_all) <span class="sc">|&gt;</span> </span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  jsonlite<span class="sc">::</span><span class="fu">fromJSON</span>()</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>job_groups</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$Management
 [1] "Data Engineering Manager"                  
 [2] "Program Director"                          
 [3] "Library director"                          
 [4] "Sr Contracts Manager"                      
 [5] "Director of Customer Experience"           
 [6] "office manager"                            
 [7] "Payor Support Specialist"                  
 [8] "Head of Devops"                            
 [9] "Senior Program Manager"                    
[10] "Digital Account Manager"                   
[11] "Manager"                                   
[12] "Customer Success Manager"                  
[13] "EA"                                        
[14] "Admin"                                     
[15] "Executive assistant"                       
[16] "VP Marketing/Merchandising/Creative"       
[17] "Sr Manager"                                
[18] "Human Resource Manager"                    
[19] "Office Manager"                            
[20] "HR Coordinator"                            
[21] "IT Helpdesk Assistant"                     
[22] "HR Operations Manager"                     
[23] "Account coordinator"                       
[24] "Research scientist"                        
[25] "Government worker"                         
[26] "Service Manager"                           
[27] "Marketing Coordinator"                     
[28] "Consultant"                                
[29] "Administrative Assistant &amp; Systems Analyst"
[30] "Alliance Manager"                          
[31] "Marketing Manager"                         
[32] "Administrative Assistant"                  
[33] "Manager, Access Services"                  
[34] "Sr. Account Relationship Manager"          
[35] "RN coordinator"                            
[36] "Digital print technician"                  
[37] "Benefits &amp; Compensation Manager"           
[38] "Director of Development"                   
[39] "Senior Associate"                          
[40] "Library Director"                          
[41] "Team Lead Inbound Scheduling"              
[42] "Grants Manager"                            
[43] "HR Manager"                                
[44] "Graduate Student"                          
[45] "Director of Software Engineering"          
[46] "Clinical Trainer"                          
[47] "Quality Manager"                           
[48] "Veterinary technician supervisor"          
[49] "Executive Director"                        

$Engineering
 [1] "Data Engineer"                     "Frontend Engineer"                
 [3] "Devops Engineer"                   "Software Engineer"                
 [5] "Senior Software Engineer"          "Cognitive implementation engineer"
 [7] "Water Resources Engineer"          "Staff Engineering Analyst"        
 [9] "Mechanical drafter"                "IT Business Analyst"              
[11] "Web Developer"                     "Security engineer"                
[13] "Software Dev"                      "Database Administrator"           

$Science
 [1] "Postdoc"                        "Research manager"              
 [3] "Psychotherapist"                "Financial Controller"          
 [5] "Director of Research Services"  "Associate Professor"           
 [7] "Geologist"                      "Machine Learning Engineer"     
 [9] "Cytogenetics Technologist"      "Psychologist"                  
[11] "Licensed Clinical Psychologist" "Partner"                       
[13] "Actuary"                        "Chemical Engineer"             

$Education
[1] "Teacher"                                
[2] "World Language teacher"                 
[3] "High school teacher"                    
[4] "EL kindergarten teacher"                
[5] "Adjunct professor and exhibiting artist"
[6] "Associate Director of Admissions"       
[7] "Professor of [Humanities Discipline]"   
[8] "Instructor"                             

$Law
[1] "Attorney"                                  
[2] "Lawyer"                                    
[3] "Patent attorney"                           
[4] "Licensed Mental Health Counselor"          
[5] "Global digital and social media HR manager"

$Finance
[1] "Financial Controller"            "Forecasting Analyst"            
[3] "Billing Manager"                 "Loan Processor"                 
[5] "Accounting Assistant"            "Bookkeeper"                     
[7] "investment advisor"              "Director of Revenue Cycle &amp; EHR"

$Healthcare
[1] "Psychotherapist"                  "RN coordinator"                  
[3] "Veterinary technician supervisor" "Clinical Trainer"                

$IT
[1] "Communications Logistics Analyst"   "Communications Strategist"         
[3] "Digital Account Manager"            "IT Helpdesk Assistant"             
[5] "Web Developer"                      "Database Administrator"            
[7] "Salesforce administrator/developer" "Software Engineer 2"               

$Marketing
[1] "Communications Strategist"           
[2] "Senior Digital Marketing Executive"  
[3] "Marketing and Communications Manager"
[4] "Marketing Coordinator"               
[5] "VP Membership and Programs"          

$Research
[1] "Postdoc"                       "Research manager"             
[3] "Director of Research Services" "Research scientist"           
[5] "Program Coordinator"           "Resource specialist"          
[7] "Graduate Student"             

$Sales
[1] "Sales analyst"              "Solutions Consultant"      
[3] "Lead Product Designer"      "VP Membership and Programs"

$Other
[1] "Communications associate" "stripper"                
[3] "student"                  "Games Specialist"        
[5] "product photographer"     "Waitress"                </code></pre>
</div>
</div>
</section>
<section id="sec-classify" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="sec-classify"><span class="header-section-number">2.2</span> Classification</h3>
<p>Once we identify the classification groups like in <a href="#sec-cluster" class="quarto-xref">Section&nbsp;2.1</a> or otherwise, we can classify each job title to one of these groups as below. We’ll only classify 20 observations as this will be time consuming for a demonstration.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>groups <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">names</span>(job_groups), <span class="at">collapse =</span> <span class="st">", "</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>job_classifier <span class="ot">&lt;-</span> <span class="fu">chat_ollama</span>(<span class="at">model =</span> <span class="st">"llama3.1:8b"</span>,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">system_prompt =</span> <span class="fu">paste0</span>(<span class="st">"Classify the input text to ["</span>, groups,<span class="st">"]. Just return the group only."</span>),</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">seed =</span> <span class="dv">1</span>,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">api_args =</span> <span class="fu">list</span>(<span class="at">top_p =</span> <span class="fl">0.5</span>,</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">temperature =</span> <span class="dv">0</span>))</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>jobs <span class="ot">&lt;-</span> <span class="fu">map_chr</span>(salary_sample<span class="sc">$</span>job_title[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>], <span class="sc">~</span>job_classifier<span class="sc">$</span><span class="fu">chat</span>(.x))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The resulting classification can be seen in <a href="#tbl-class" class="quarto-xref">Table&nbsp;2</a>. Do you agree with the classifications? Some I don’t agree with (e.g.&nbsp;Technical Writer grouped as Engineering but most others look good to me).</p>
<div class="cell">
<div id="tbl-class" class="cell quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-class-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: The classification of the job title to a group.
</figcaption>
<div aria-describedby="tbl-class-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Job Title</th>
<th style="text-align: left;">Group</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Technical Writer</td>
<td style="text-align: left;">Engineering</td>
</tr>
<tr class="even">
<td style="text-align: left;">Executive assistant</td>
<td style="text-align: left;">Management</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Archivist</td>
<td style="text-align: left;">Other</td>
</tr>
<tr class="even">
<td style="text-align: left;">Associate Director of Admissions</td>
<td style="text-align: left;">Education</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Senior examiner (claims)</td>
<td style="text-align: left;">Law</td>
</tr>
<tr class="even">
<td style="text-align: left;">Library Director</td>
<td style="text-align: left;">Education</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Machine Learning Engineer</td>
<td style="text-align: left;">Engineering</td>
</tr>
<tr class="even">
<td style="text-align: left;">Assistant Director, Finance</td>
<td style="text-align: left;">Finance</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Librarian</td>
<td style="text-align: left;">Education</td>
</tr>
<tr class="even">
<td style="text-align: left;">Learning Designer</td>
<td style="text-align: left;">Education</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Senior policy analyst</td>
<td style="text-align: left;">Law</td>
</tr>
<tr class="even">
<td style="text-align: left;">Operations Manager</td>
<td style="text-align: left;">Management</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Lead Marketing Analyst</td>
<td style="text-align: left;">Marketing</td>
</tr>
<tr class="even">
<td style="text-align: left;">Production manager</td>
<td style="text-align: left;">Engineering</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sr.&nbsp;Executive Assistant</td>
<td style="text-align: left;">Management</td>
</tr>
<tr class="even">
<td style="text-align: left;">Regulatory Manager</td>
<td style="text-align: left;">Law</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Finance Director</td>
<td style="text-align: left;">Finance</td>
</tr>
<tr class="even">
<td style="text-align: left;">Assistant manager</td>
<td style="text-align: left;">Management</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Solicitor</td>
<td style="text-align: left;">Law</td>
</tr>
<tr class="even">
<td style="text-align: left;">Billing Manager</td>
<td style="text-align: left;">Finance</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>It is best to scan all classification and if there is only a small issue, you can manually correct these. If there are more, you can give some examples of what is the correct classification to LLM and reclassify all.</p>
</section>
<section id="standardise-data" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="standardise-data"><span class="header-section-number">2.3</span> Standardise data</h3>
<p>In the survey, respondents entered their country by text entry. If you look at the entries below, you’ll notice that there are many variations of the same country, e.g.&nbsp;“United States” and “USA”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>salary_sample <span class="sc">|&gt;</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># there is one entry, which is an </span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># answer to another question so remove for now</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">nchar</span>(country) <span class="sc">&lt;</span> <span class="dv">25</span>) <span class="sc">|&gt;</span> </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(country, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="cn">Inf</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 29 × 2
   country                      n
   &lt;chr&gt;                    &lt;int&gt;
 1 United States              141
 2 USA                        128
 3 US                          34
 4 Canada                      23
 5 United Kingdom               8
 6 United States of America     8
 7 U.S.                         7
 8 UK                           7
 9 Usa                          5
10 Ireland                      4
11 united states                4
12 usa                          4
13 Australia                    3
14 Germany                      3
15 England                      2
16 Netherlands                  2
17 The Netherlands              2
18 Uk                           2
19 United states                2
20 CANADA                       1
21 China                        1
22 France                       1
23 IS                           1
24 India                        1
25 Israel                       1
26 New zealand                  1
27 Philippines                  1
28 SWITZERLAND                  1
29 U.S                          1</code></pre>
</div>
</div>
<p>You can use a method similar to <a href="#sec-classify" class="quarto-xref">Section&nbsp;2.2</a> to standardise the country entries, however, this has been conveniently wrapped as a function <code>sai_fct_match</code> in the <code>SAI</code> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>country <span class="ot">&lt;-</span> <span class="fu">sai_fct_match</span>(</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  salary_sample<span class="sc">$</span>country,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"United States America"</span>,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Canada"</span>,</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"United Kingdom"</span>,</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Ireland"</span>,</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Iceland"</span>,</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"India"</span>,</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Israel"</span>,</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"New Zealand"</span>,</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Switzerland"</span>,</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Philippines"</span>,</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"China"</span>,</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"France"</span>,</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Netherlands"</span>,</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Australia"</span>,</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Germany"</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The above conversion can be seen in <a href="#tbl-convert" class="quarto-xref">Table&nbsp;3</a>. You can notice that while most are correct, not all where mapped correctly. Since these are only small numbers of these, you can correct these manually.</p>
<div class="cell omitshadow">
<div id="tbl-convert" class="cell omitshadow quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-convert-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3: Conversion of the country to select levels.
</figcaption>
<div aria-describedby="tbl-convert-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell omitshadow table table-sm table-striped small">
<colgroup>
<col style="width: 86%">
<col style="width: 13%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">original</th>
<th style="text-align: left;">converted</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">United States</td>
<td style="text-align: left;">United States America</td>
</tr>
<tr class="even">
<td style="text-align: left;">Canada</td>
<td style="text-align: left;">Canada</td>
</tr>
<tr class="odd">
<td style="text-align: left;">USA</td>
<td style="text-align: left;">United States America</td>
</tr>
<tr class="even">
<td style="text-align: left;">US</td>
<td style="text-align: left;">United States America</td>
</tr>
<tr class="odd">
<td style="text-align: left;">United states</td>
<td style="text-align: left;">United States America</td>
</tr>
<tr class="even">
<td style="text-align: left;">United States of America</td>
<td style="text-align: left;">United States America</td>
</tr>
<tr class="odd">
<td style="text-align: left;">New zealand</td>
<td style="text-align: left;">New Zealand</td>
</tr>
<tr class="even">
<td style="text-align: left;">United Kingdom</td>
<td style="text-align: left;">United Kingdom</td>
</tr>
<tr class="odd">
<td style="text-align: left;">UK</td>
<td style="text-align: left;">United Kingdom</td>
</tr>
<tr class="even">
<td style="text-align: left;">Uk</td>
<td style="text-align: left;">United Kingdom</td>
</tr>
<tr class="odd">
<td style="text-align: left;">usa</td>
<td style="text-align: left;">United States America</td>
</tr>
<tr class="even">
<td style="text-align: left;">Usa</td>
<td style="text-align: left;">United States America</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Germany</td>
<td style="text-align: left;">Germany</td>
</tr>
<tr class="even">
<td style="text-align: left;">Australia</td>
<td style="text-align: left;">Australia</td>
</tr>
<tr class="odd">
<td style="text-align: left;">India</td>
<td style="text-align: left;">India</td>
</tr>
<tr class="even">
<td style="text-align: left;">Israel</td>
<td style="text-align: left;">Israel</td>
</tr>
<tr class="odd">
<td style="text-align: left;">united states</td>
<td style="text-align: left;">United States America</td>
</tr>
<tr class="even">
<td style="text-align: left;">Netherlands</td>
<td style="text-align: left;">Netherlands</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SWITZERLAND</td>
<td style="text-align: left;">Switzerland</td>
</tr>
<tr class="even">
<td style="text-align: left;">U.S</td>
<td style="text-align: left;">United States America</td>
</tr>
<tr class="odd">
<td style="text-align: left;">U.S.</td>
<td style="text-align: left;">United States America</td>
</tr>
<tr class="even">
<td style="text-align: left;">The Netherlands</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">I was brought in on this salary to help with the EHR and very quickly was promoted to current position but compensation was not altered.</td>
<td style="text-align: left;">United States America</td>
</tr>
<tr class="even">
<td style="text-align: left;">Ireland</td>
<td style="text-align: left;">Ireland</td>
</tr>
<tr class="odd">
<td style="text-align: left;">France</td>
<td style="text-align: left;">France</td>
</tr>
<tr class="even">
<td style="text-align: left;">China</td>
<td style="text-align: left;">China</td>
</tr>
<tr class="odd">
<td style="text-align: left;">England</td>
<td style="text-align: left;">United Kingdom</td>
</tr>
<tr class="even">
<td style="text-align: left;">IS</td>
<td style="text-align: left;">United States America</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Philippines</td>
<td style="text-align: left;">Philippines</td>
</tr>
<tr class="even">
<td style="text-align: left;">CANADA</td>
<td style="text-align: left;">Canada</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/emitanaka\.org\/workshop-LLM-2024\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>