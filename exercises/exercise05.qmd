---
title: "Modelling with categorical variables"
description: "[Exercise 5]{.tag-workshop}"
image: /images/ex5-cover.jpeg
format: live-html
webr:
  packages:
    - broom
    - tidyverse
    - emmeans
    - ggResidpanel
    - MASS
---


{{< include _head.qmd >}}

```{webr}
#| autorun: true
#| edit: false
#| startover: false
#| runbutton: false
library(tidyverse)
```


```{webr}
#| include: false
#| autorun: true
options(width = 70)
```

## Which insect spray is the most effective?

The `InsectSprays` dataset contains the counts of insects in agricultural experimental units treated with six different insecticides. The variable `count` represents the number of insects after using the `spray`.

```{webr}
#| edit: false
glimpse(InsectSprays)
```



### Exercise 5.1.1

- First let's plot the data. What does the following code do? What is the most effective to the least effective insect spray based on this plot?

```{webr}
#| exercise: ex11
#| caption: "Exercise 5.1.1"
ggplot(InsectSprays, aes(spray, count)) +
  geom_boxplot() + 
  geom_jitter(width = 0.1, color = "blue3")
```


::: {.solution exercise="ex1"}

**Answer**: The plot is a boxplot superimposed with a stripchart showing the number of insects for each insect spray. On visual inspection, the effectiveness of the spray seem to fall into two distinct groups: the ineffective group consists of `F`, `A` and `B`, while the effective group consists of `D`, `E`, and `C`.

The boxplot suggests that the distribution is slightly skewed (the median does not appear in the middle of the boxes). We may like to consider some transformation to make the distribution more symmetric.

:::

### Exercise 5.1.2

- Use the `boxcox()` function to find the optimal transformation for the `count` variable. Why are we adding `0.001` to the `count` variable? What transformation should we use for the response?

```{webr}
#| exercise: ex12
#| caption: "Exercise 5.1.2"
boxcox(lm(count + 0.001 ~ spray, data = InsectSprays))
```

::: {.solution exercise="ex12"}

**Answer**: We add `0.001` to the `count` variable to avoid taking the log of zero. The optimal transformation is $\lambda \approx 0.5$, which suggests that we should take the square root of the `count` variable.

:::


### Exercise 5.1.3

- Fit a linear model with the square root of the `count` variable as the response and the `spray` variable as the predictor. What are the best to least effective insect spray based on the estimated marginal means for each insect spray? Are there any significant differences between the insect sprays after adjusting for Bonferroni correction?

```{webr}
#| exercise: ex13
fit <- lm(sqrt(count) ~ spray, data = InsectSprays)
(emm <- emmeans(fit, ~ spray))
pairs(emm, adjust = "bonferroni")
```

::: {.solution exercise="ex13"}

Based on the estimated marginal means, the most effective insect spray is `C`, followed by `E`, `D`, `A`, `B`, and `F`. 

The pairwise comparisons suggest that there are no significant differences between the sprays `A`, `B` and `F` (these are all ineffective). While `C` and `E` are not significantly different, nor is `D` and `E`. However, `C` is significantly different from `D`. This suggests that spray `C` should be recommended for usage for the best results in similar experimental conditions.

:::


<br><br>

---

ðŸŽ‰ _`r praise::praise("${Exclamation}! ")`_ You've reached the end of this exercise! _`r praise::praise("You are ${adjective}!")`_ Proceed to ...<br><br>


[<i class="fas fa-caret-square-right"></i> next slide](/slides/slide6.html){.button-next} <br><br>

[<i class="fas fa-caret-square-right"></i>  next exercise](/exercises/exercise06.html){.button-next}